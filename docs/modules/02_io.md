# IO Module Conversion

This document details the conversion of the Neo N3 C# IO module to Rust.

## Module Overview

The IO module provides data structures for caching and collection interaction, including:

- Binary serialization/deserialization
- Memory management
- Caching mechanisms
- Actor model implementation

## Type Mappings

| C# Type | Rust Type | Notes |
|---------|-----------|-------|
| `Stream` | `std::io::Read`/`std::io::Write` | Split into read and write traits |
| `BinaryReader` | Custom `BinaryReader` struct | Implement over `Read` |
| `BinaryWriter` | Custom `BinaryWriter` struct | Implement over `Write` |
| `MemoryStream` | `std::io::Cursor<Vec<u8>>` | In-memory buffer with cursor |
| `ISerializable` | `Serializable` trait | Define custom trait for Neo serialization |

## File Mappings

| C# File | Rust File | Implementation Status |
|---------|-----------|------------------------|
| `Actors/PriorityMailbox.cs` | `actors/priority_mailbox.rs` | ðŸ”´ Not Started |
| `Actors/PriorityMessageQueue.cs` | `actors/priority_message_queue.rs` | ðŸ”´ Not Started |
| `Caching/ECDsaCache.cs` | `caching/ecdsa_cache.rs` | ðŸ”´ Not Started |
| `Caching/ECPointCache.cs` | `caching/ecpoint_cache.rs` | ðŸ”´ Not Started |
| `Caching/ReflectionCache.cs` | `caching/reflection_cache.rs` | ðŸ”´ Not Started |
| `Caching/RelayCache.cs` | `caching/relay_cache.rs` | ðŸ”´ Not Started |
| `Extensions/BinaryReaderExtensions.cs` | `binary_reader.rs` (methods) | ðŸ”´ Not Started |
| `Extensions/BinaryWriterExtensions.cs` | `binary_writer.rs` (methods) | ðŸ”´ Not Started |
| `Extensions/ISerializableExtensions.cs` | `serializable.rs` (trait methods) | ðŸ”´ Not Started |
| `Extensions/MemoryReaderExtensions.cs` | `memory_reader.rs` | ðŸ”´ Not Started |

## Detailed Conversion Notes

### Binary Serialization

**C# Implementation:**
- `BinaryReader`/`BinaryWriter` classes for reading/writing binary data
- Extension methods for Neo-specific types
- Support for variable-length integers, strings, and arrays

**Rust Implementation:**
- Custom `BinaryReader`/`BinaryWriter` structs
- Implement methods directly on the structs (no extension methods in Rust)
- Use generics and traits for type-safe serialization
- Ensure consistent endianness (little-endian for Neo)

### Caching

**C# Implementation:**
- Various cache implementations for different Neo types
- Time-based expiration
- Memory usage optimization

**Rust Implementation:**
- Use `lru` crate for LRU cache implementation
- Implement time-based expiration with `std::time`
- Consider thread-safety with `Arc`/`Mutex`

### Actor Model

**C# Implementation:**
- Priority-based message processing
- Mailbox and queue implementations

**Rust Implementation:**
- Consider using `tokio` or `actix` for actor model
- Implement custom priority queue if needed
- Ensure compatibility with Neo message processing requirements

## Dependencies

- `bytes`: For efficient byte buffer manipulation
- `lru`: For LRU cache implementation
- `tokio` or `actix`: For actor model (if needed)
- `serde`: For serialization/deserialization (optional)

## Testing Strategy

1. Convert all C# unit tests to Rust
2. Add additional tests for Rust-specific edge cases
3. Test serialization/deserialization compatibility with C# implementation
4. Benchmark performance against C# implementation
